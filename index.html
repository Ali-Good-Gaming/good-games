<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sapper Ultimate Elite | ALI_GOOD_GAMING</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Montserrat:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* ================================================================
           1. –¶–í–ï–¢–û–í–´–ï –°–•–ï–ú–´ –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï (THEMES ENGINE)
           ================================================================
        */
        :root {
            /* –ë–∞–∑–æ–≤–∞—è —Ç–µ–º–∞: Cyber Neon (–¢–≤–æ—è –ª—é–±–∏–º–∞—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) */
            --primary: #e94560;
            --primary-glow: rgba(233, 69, 96, 0.6);
           --bg-body: #121212;
            --bg-glass: rgba(15, 52, 96, 0.1);
            --bg-modal: rgba(10, 11, 30, 0.98);
            --text-main: #ffffff;
            --text-dim: rgba(255, 255, 255, 0.5);
            --cell-bg: rgba(255, 255, 255, 0.07);
            --cell-border: rgba(255, 255, 255, 0.1);
            --font-display: 'Orbitron', sans-serif;
            --font-main: 'Montserrat', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
            --trans: 0.4s cubic-bezier(0.2, 1, 0.3, 1);
        }

        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ–º—ã —Å –≤—ã–≤–µ—Ä–µ–Ω–Ω—ã–º –∫–æ–Ω—Ç—Ä–∞—Å—Ç–æ–º */
        [data-theme="ocean"] {
            --primary: #00d2ff; --primary-glow: rgba(0, 210, 255, 0.6);
            --bg-body: #010a12; --bg-glass: rgba(0, 210, 255, 0.05);
        }
        [data-theme="emerald"] {
            --primary: #00ff88; --primary-glow: rgba(0, 255, 136, 0.6);
            --bg-body: #020f08; --bg-glass: rgba(0, 255, 136, 0.05);
        }
        [data-theme="gold"] {
            --primary: #f1c40f; --primary-glow: rgba(241, 196, 15, 0.6);
            --bg-body: #0c0b02; --bg-glass: rgba(241, 196, 15, 0.05);
        }
        [data-theme="blood"] {
            --primary: #ff0040; --primary-glow: rgba(255, 0, 64, 0.6);
            --bg-body: #0a0104; --bg-glass: rgba(255, 0, 64, 0.05);
        }

        /* ================================================================
           2. –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò –ò –°–ï–¢–ö–ê
           ================================================================
        */
        * {
            box-sizing: border-box;
            margin: 0; padding: 0;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
           body {
    background-color: var(--bg-body);
    color: var(--text-main);
    font-family: var(--font-main);
    height: 100vh;
    width: 100vw;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: background 1s ease;
}
            color: var(--text-main);
            font-family: var(--font-main);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 1s ease;
        }

        canvas#particle-canvas {
            position: fixed;
            top: 0; left: 0;
            z-index: 1;
            pointer-events: none; /* –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∫–ª–∏–∫–∏ –∫ –∏–≥—Ä–µ */
        }

        #ui-wrapper {
            position: relative;
            z-index: 10;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* ================================================================
           3. –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ (–ö–õ–ê–°–°–ò–ß–ï–°–ö–ò–ô –î–ò–ó–ê–ô–ù)
           ================================================================
        */
        .screen {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 600px;
            animation: fadeIn 0.8s ease-out;
        }

        .screen.active { display: flex; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .main-logo {
            font-family: var(--font-display);
            font-size: clamp(3.5rem, 15vw, 6.5rem);
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: -2px;
            background: linear-gradient(to bottom, #fff 40%, var(--primary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 25px var(--primary-glow));
            line-height: 0.9;
        }

        .brand-label {
            font-family: var(--font-mono);
            font-size: 0.85rem;
            letter-spacing: 12px;
            color: var(--primary);
            text-transform: uppercase;
            font-weight: 700;
            margin-bottom: 50px;
            opacity: 0.8;
            margin-left: 12px;
        }

        .btn-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            padding: 0 40px;
        }

        .btn {
            #board-container {
    background: #020205; /* –ü–æ—á—Ç–∏ —á–µ—Ä–Ω—ã–π, —Å–ø–ª–æ—à–Ω–æ–π —Ü–≤–µ—Ç */
    padding: 15px;       /* –ß—É—Ç—å —É–≤–µ–ª–∏—á–∏–º –æ—Ç—Å—Ç—É–ø –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã */
    border-radius: 25px;
    border: 1px solid var(--cell-border);
    box-shadow: 0 30px 60px rgba(0,0,0,0.8); /* –¢–µ–Ω—å –ø–æ—Å–∏–ª—å–Ω–µ–µ */
    position: relative;
    z-index: 20; /* –ü–æ–¥–Ω–∏–º–∞–µ–º –ø–æ–ª–µ –ù–ê–î —á–∞—Å—Ç–∏—Ü–∞–º–∏ */
}
            border: 1px solid var(--cell-border);
            color: #fff;
            padding: 22px 35px;
            font-family: var(--font-display);
            font-size: 1.1rem;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--trans);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            backdrop-filter: blur(10px);
            text-transform: uppercase;
            letter-spacing: 3px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: 0.5s;
        }

        .btn:hover {
            border-color: var(--primary);
            background: rgba(var(--primary-glow), 0.15);
            transform: scale(1.05) translateX(5px);
            box-shadow: 0 0 30px rgba(0,0,0,0.5), inset 0 0 15px var(--primary-glow);
        }

        .btn:hover::before { left: 100%; }

        .btn.primary {
            background: var(--primary);
            border: none;
            box-shadow: 0 10px 30px var(--primary-glow);
        }

        .social-row {
            display: flex;
            gap: 20px;
            margin-bottom: 40px;
        }

        .icon-btn {
            width: 55px; height: 55px;
            border-radius: 15px;
            background: var(--bg-glass);
            border: 1px solid var(--cell-border);
            display: flex;
            justify-content: center; align-items: center;
            color: #fff; font-size: 1.4rem;
            transition: var(--trans);
        }

        .icon-btn:hover {
            background: var(--primary);
            transform: translateY(-5px) rotate(10deg);
            box-shadow: var(--primary-glow);
        }

        /* ================================================================
           4. –ò–ì–†–û–í–û–ô –ò–ù–¢–ï–†–§–ï–ô–° (HUD & BOARD)
           ================================================================
        */
        .game-header {
            width: 95%;
            max-width: 500px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: var(--bg-glass);
            padding: 20px 30px;
            border-radius: 30px;
            border: 1px solid var(--cell-border);
            backdrop-filter: blur(15px);
        }

        .hud-box { text-align: center; }
        .hud-label {
            font-size: 0.6rem;
            letter-spacing: 2px;
            color: var(--text-dim);
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        .hud-value {
            font-family: var(--font-mono);
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #board-container {
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 25px;
            border: 1px solid var(--cell-border);
            box-shadow: 0 30px 60px rgba(0,0,0,0.6);
        }

        #minefield {
            display: grid;
            gap: 6px;
        }

        .cell {
            width: 42px; height: 42px;
            background: var(--cell-bg);
            border: 1px solid var(--cell-border);
            border-radius: 10px;
            display: flex;
            justify-content: center; align-items: center;
            font-weight: 900; font-size: 1.3rem;
            transition: all 0.25s cubic-bezier(0.1, 0.9, 0.2, 1);
            cursor: pointer;
            position: relative;
        }

        .cell:hover:not(.revealed) {
            background: rgba(255,255,255,0.15);
            transform: scale(1.08);
            z-index: 2;
            border-color: var(--primary);
        }

        .cell.revealed {
            background: rgba(0,0,0,0.2);
            border-color: transparent;
            cursor: default;
        }

        .cell.mine {
            background: var(--primary) !important;
            color: white;
            box-shadow: 0 0 25px var(--primary);
            animation: mineBoom 0.5s ease-out;
        }

        @keyframes mineBoom {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        .cell.flagged::after {
            content: 'üö©';
            font-size: 1.1rem;
        }

        /* –¶–≤–µ—Ç–∞ —Ü–∏—Ñ—Ä */
        .val-1 { color: #3498db; } .val-2 { color: #2ecc71; } 
        .val-3 { color: #e74c3c; } .val-4 { color: #9b59b6; }
        .val-5 { color: #f1c40f; }

        /* ================================================================
           5. –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê –ò –ó–ê–©–ò–¢–ê SHORTS
           ================================================================
        */
        .overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(20px);
            z-index: 1000;
            display: none;
            justify-content: center; align-items: center;
            opacity: 0; transition: 0.5s;
        }

        .overlay.visible { display: flex; opacity: 1; }

        .modal {
            background: var(--bg-modal);
            border: 1px solid var(--primary);
            width: 90%; max-width: 450px;
            padding: 40px; border-radius: 35px;
            text-align: center;
            box-shadow: 0 0 50px rgba(var(--primary-glow), 0.2);
        }

        #shorts-container {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 2000;
            display: none;
            flex-direction: column;
        }

        #shorts-container.visible { display: flex; }

        .shorts-header {
            padding: 20px; display: flex; justify-content: space-between;
            align-items: center; background: rgba(255,255,255,0.05);
        }

        .timer-badge {
            background: var(--primary);
            padding: 8px 15px; border-radius: 10px;
            font-family: var(--font-mono); font-weight: bold;
        }

        iframe#yt-player { width: 100%; flex-grow: 1; border: none; }

        /* ================================================================
           6. –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨
           ================================================================
        */
        @media (max-width: 500px) {
            .cell { width: 34px; height: 34px; font-size: 1rem; }
            .main-logo { font-size: 4rem; }
            .brand-label { font-size: 0.6rem; letter-spacing: 8px; }
            .btn { padding: 18px 25px; font-size: 0.9rem; }
        }
    </style>
</head>
<body data-theme="neon">

    <canvas id="particle-canvas"></canvas>

    <div id="ui-wrapper">
        
        <main id="menu-screen" class="screen active">
            <h1 class="main-logo">Sapper</h1>
            <div class="brand-label">ALI_GOOD_GAMING</div>

            <div class="social-row">
                <a href="https://youtube.com/@ali-gg" target="_blank" class="icon-btn"><i class="fab fa-youtube"></i></a>
                <a href="https://t.me/aligoodgaming" target="_blank" class="icon-btn"><i class="fab fa-telegram"></i></a>
                <a href="https://tiktok.com/@ali_goodgaming" target="_blank" class="icon-btn"><i class="fab fa-tiktok"></i></a>
            </div>

            <div class="btn-container">
                <button class="btn primary" onclick="App.startGame()">
                    <i class="fas fa-play"></i> <span data-i18n="play">–ò–≥—Ä–∞—Ç—å</span>
                </button>
                <button class="btn" onclick="App.openSettings()">
                    <i class="fas fa-cog"></i> <span data-i18n="settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
                </button>
                <button class="btn" onclick="App.openRecords()">
                    <i class="fas fa-trophy"></i> <span data-i18n="records">–†–µ–∫–æ—Ä–¥—ã</span>
                </button>
            </div>
        </main>

        <main id="game-screen" class="screen">
            <div class="game-header">
                <div class="hud-box">
                    <div class="hud-label" data-i18n="mines">–ú–∏–Ω—ã</div>
                    <div id="mine-count" class="hud-value">üí£ 010</div>
                </div>

                <div style="width: 60px; height: 60px; display: flex; justify-content: center; align-items: center; cursor: pointer;" onclick="Game.init()">
                    <i class="fas fa-sync-alt" style="font-size: 1.5rem; color: var(--primary);"></i>
                </div>

                <div class="hud-box">
                    <div class="hud-label" data-i18n="time">–í—Ä–µ–º—è</div>
                    <div id="game-timer" class="hud-value">‚è≥ 00:00</div>
                </div>
            </div>

            <div id="board-container">
                <div id="minefield"></div>
            </div>

            <div style="margin-top: 30px; display: flex; gap: 15px; width: 100%; padding: 0 20px;">
                <button class="btn" style="flex: 1; padding: 15px;" onclick="Game.getHint()">
                    <i class="fas fa-lightbulb"></i> <span data-i18n="hint">–•–∏–Ω—Ç</span>
                </button>
                <button class="btn" style="flex: 1; padding: 15px;" onclick="App.showScreen('menu')">
                    <i class="fas fa-home"></i> <span data-i18n="menu">–ú–µ–Ω—é</span>
                </button>
            </div>
        </main>
    </div>

    <div id="modal-overlay" class="overlay">
        <div class="modal">
            <h2 id="modal-title" style="font-family: var(--font-display); color: var(--primary); margin-bottom: 20px; font-size: 2rem;">INFO</h2>
            <p id="modal-desc" style="font-size: 1.1rem; line-height: 1.6; margin-bottom: 30px;"></p>
            <button class="btn primary" style="width: 100%;" onclick="App.closeModal()">OK</button>
        </div>
    </div>

    <div id="shorts-container">
        <div class="shorts-header">
            <div style="font-family: var(--font-display); font-size: 0.8rem;">ALI_GG PREMIUM CONTENT</div>
            <div id="shorts-timer" class="timer-badge">15s</div>
            <div onclick="Game.cancelShorts()" style="cursor: pointer; font-size: 1.5rem;"><i class="fas fa-times"></i></div>
        </div>
        <iframe id="yt-player" src=""></iframe>
    </div>

<script>
/**
 * ========================================================================
 * 1. –ö–û–ù–°–¢–ê–ù–¢–´ –ò –õ–û–ö–ê–õ–ò–ó–ê–¶–ò–Ø
 * ========================================================================
 */
const I18N = {
    ru: {
        play: "–ò–≥—Ä–∞—Ç—å", settings: "–ù–∞—Å—Ç—Ä–æ–π–∫–∏", records: "–†–µ–∫–æ—Ä–¥—ã",
        mines: "–ú–∏–Ω—ã", time: "–í—Ä–µ–º—è", hint: "–ü–æ–º–æ—â—å", menu: "–ú–µ–Ω—é",
        win: "–ü–û–ë–ï–î–ê! üéâ", lose: "–ë–£–ú! üíÄ", easy: "–õ–µ–≥–∫–æ", med: "–°—Ä–µ–¥–Ω–µ", hard: "–≠–∫—Å–ø–µ—Ä—Ç",
        wait: "–°–º–æ—Ç—Ä–∏ –µ—â–µ: ", get_hint: "–ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞!"
    },
    en: {
        play: "Play", settings: "Settings", records: "Records",
        mines: "Mines", time: "Time", hint: "Hint", menu: "Menu",
        win: "VICTORY! üéâ", lose: "BOOM! üíÄ", easy: "Easy", med: "Medium", hard: "Expert",
        wait: "Wait: ", get_hint: "Hint Unlocked!"
    }
};

const VIDEO_IDS = [
    "z0yLX-BKyQo", "YDCA39Ns8vo", "qxuAyYfXtRA", "Np20JpunLJY", "zwhkYTpjt3A",
    "t0Q2otsqC4I", "Sqj1d8I4qH4", "v33-kGj7A7M", "5hS9M2lRToA", "XJ7p9F4M_7Y"
];

/**
 * ========================================================================
 * 2. –î–í–ò–ñ–û–ö –ß–ê–°–¢–ò–¶ (–ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–´–ô –§–û–ù)
 * ========================================================================
 */
const Particles = {
    canvas: document.getElementById('particle-canvas'),
    ctx: null,
    items: [],
    mouse: { x: -1000, y: -1000 },

    init() {
        this.ctx = this.canvas.getContext('2d');
        this.resize();
        window.addEventListener('resize', () => this.resize());
        window.addEventListener('mousemove', (e) => {
            this.mouse.x = e.clientX;
            this.mouse.y = e.clientY;
        });
        
        for(let i=0; i<80; i++) {
            this.items.push({
                x: Math.random() * this.canvas.width,
                y: Math.random() * this.canvas.height,
                vx: (Math.random() - 0.5) * 0.5,
                vy: (Math.random() - 0.5) * 0.5,
                r: Math.random() * 2 + 1
            });
        }
        this.draw();
    },

    resize() {
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight;
    },

    draw() {
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        const color = getComputedStyle(document.documentElement).getPropertyValue('--primary');

        this.items.forEach(p => {
            // –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏—Ç—è–∂–µ–Ω–∏—è –∫ –º—ã—à–∏
            let dx = this.mouse.x - p.x;
            let dy = this.mouse.y - p.y;
            let dist = Math.sqrt(dx*dx + dy*dy);
            
            if(dist < 200) {
                p.x += dx * 0.01;
                p.y += dy * 0.01;
            }

            p.x += p.vx;
            p.y += p.vy;

            if(p.x < 0 || p.x > this.canvas.width) p.vx *= -1;
            if(p.y < 0 || p.y > this.canvas.height) p.vy *= -1;

            this.ctx.beginPath();
            this.ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
            this.ctx.fillStyle = color;
            this.ctx.globalAlpha = 0.4;
            this.ctx.fill();
        });

        // –õ–∏–Ω–∏–∏ –º–µ–∂–¥—É —á–∞—Å—Ç–∏—Ü–∞–º–∏
        for(let i=0; i<this.items.length; i++) {
            for(let j=i+1; j<this.items.length; j++) {
                let d = Math.sqrt((this.items[i].x - this.items[j].x)**2 + (this.items[i].y - this.items[j].y)**2);
                if(d < 100) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(this.items[i].x, this.items[i].y);
                    this.ctx.lineTo(this.items[j].x, this.items[j].y);
                    this.ctx.strokeStyle = color;
                    this.ctx.globalAlpha = 1 - (d/100);
                    this.ctx.lineWidth = 0.5;
                    this.ctx.stroke();
                }
            }
        }
        requestAnimationFrame(() => this.draw());
    }
};

/**
 * ========================================================================
 * 3. –ó–í–£–ö–û–í–û–ô –î–í–ò–ñ–û–ö
 * ========================================================================
 */
const AudioFX = {
    ctx: new (window.AudioContext || window.webkitAudioContext)(),
    
    play(freq, type, dur, vol = 0.1) {
        const osc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
        gain.gain.setValueAtTime(vol, this.ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + dur);
        osc.connect(gain);
        gain.connect(this.ctx.destination);
        osc.start();
        osc.stop(this.ctx.currentTime + dur);
    },

    click() { this.play(600, 'sine', 0.1); },
    reveal() { this.play(800, 'sine', 0.05, 0.05); },
    boom() { this.play(100, 'sawtooth', 0.6, 0.2); },
    win() { 
        this.play(440, 'sine', 0.2); 
        setTimeout(() => this.play(660, 'sine', 0.4), 150); 
    }
};

/**
 * ========================================================================
 * 4. –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –°–ê–ü–ï–†–ê
 * ========================================================================
 */
const Game = {
    rows: 9, cols: 9, mines: 10,
    grid: [],
    isActive: false,
    firstClick: true,
    timer: null,
    seconds: 0,
    flags: 0,
    hintReady: true,
    currentShorts: [],

    init() {
        const diff = App.difficulty;
        const config = { easy: [9,9,10], medium: [12,12,25], expert: [16,16,45] }[diff];
        [this.rows, this.cols, this.mines] = config;

        this.grid = [];
        this.isActive = true;
        this.firstClick = true;
        this.seconds = 0;
        this.flags = 0;
        clearInterval(this.timer);
        
        // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏
        this.currentShorts = [...VIDEO_IDS].sort(() => Math.random() - 0.5);

        this.renderHUD();
        this.createBoard();
    },

    createBoard() {
        const field = document.getElementById('minefield');
        field.innerHTML = '';
        field.style.gridTemplateColumns = `repeat(${this.cols}, 1fr)`;

        for(let r=0; r<this.rows; r++) {
            this.grid[r] = [];
            for(let c=0; c<this.cols; c++) {
                const el = document.createElement('div');
                el.className = 'cell';
                el.onclick = () => this.handleReveal(r, c);
                el.oncontextmenu = (e) => { e.preventDefault(); this.handleFlag(r, c); };
                
                field.appendChild(el);
                this.grid[r][c] = { mine: false, revealed: false, flagged: false, count: 0, el: el };
            }
        }
    },

    handleReveal(r, c) {
        if(!this.isActive || this.grid[r][c].flagged) return;

        if(this.firstClick) {
            this.firstClick = false;
            this.placeMines(r, c);
            this.startTimer();
        }

        this.revealRecursive(r, c);
    },

    // –í–û–õ–ù–û–í–ê–Ø –ê–ù–ò–ú–ê–¶–ò–Ø –û–¢–ö–†–´–¢–ò–Ø
    async revealRecursive(r, c, depth = 0) {
        if(r < 0 || r >= this.rows || c < 0 || c >= this.cols) return;
        const cell = this.grid[r][c];
        if(cell.revealed || cell.flagged) return;

        // –ó–∞–¥–µ—Ä–∂–∫–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç "–≥–ª—É–±–∏–Ω—ã" (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –æ—Ç —Ç–æ—á–∫–∏ –∫–ª–∏–∫–∞)
        if(depth > 0) await new Promise(res => setTimeout(res, depth * 35));

        cell.revealed = true;
        cell.el.classList.add('revealed');
        AudioFX.reveal();

        if(cell.mine) {
            this.gameOver(false);
            return;
        }

        if(cell.count > 0) {
            cell.el.textContent = cell.count;
            cell.el.classList.add('val-' + Math.min(cell.count, 5));
        } else {
            // –†–µ–∫—É—Ä—Å–∏—è –ø–æ —Å–æ—Å–µ–¥—è–º
            for(let i=-1; i<=1; i++) {
                for(let j=-1; j<=1; j++) {
                    if(i === 0 && j === 0) continue;
                    this.revealRecursive(r+i, c+j, depth + 1);
                }
            }
        }
        this.checkWin();
    },

    placeMines(exR, exC) {
        let placed = 0;
        while(placed < this.mines) {
            let r = Math.floor(Math.random()*this.rows);
            let c = Math.floor(Math.random()*this.cols);
            // –ù–µ —Å—Ç–∞–≤–∏–º –º–∏–Ω—É –≤ —Ä–∞–¥–∏—É—Å–µ 1 –∫–ª–µ—Ç–∫–∏ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∏–∫–∞
            if(!this.grid[r][c].mine && (Math.abs(r-exR) > 1 || Math.abs(c-exC) > 1)) {
                this.grid[r][c].mine = true;
                placed++;
            }
        }

        // –ü–æ–¥—Å—á–µ—Ç —Ü–∏—Ñ—Ä
        for(let r=0; r<this.rows; r++) {
            for(let c=0; c<this.cols; c++) {
                if(this.grid[r][c].mine) continue;
                let n = 0;
                for(let i=-1; i<=1; i++) {
                    for(let j=-1; j<=1; j++) {
                        if(this.grid[r+i] && this.grid[r+i][c+j] && this.grid[r+i][c+j].mine) n++;
                    }
                }
                this.grid[r][c].count = n;
            }
        }
    },

    handleFlag(r, c) {
        if(!this.isActive || this.grid[r][c].revealed) return;
        const cell = this.grid[r][c];
        cell.flagged = !cell.flagged;
        cell.el.classList.toggle('flagged');
        this.flags += cell.flagged ? 1 : -1;
        AudioFX.click();
        this.renderHUD();
    },

    renderHUD() {
        // –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–æ–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è
        const count = this.mines - this.flags;
        const formatted = count < 0 ? "-" + String(Math.abs(count)).padStart(2, '0') : String(count).padStart(3, '0');
        document.getElementById('mine-count').textContent = "üí£ " + formatted;
    },

    startTimer() {
        this.timer = setInterval(() => {
            this.seconds++;
            const m = Math.floor(this.seconds/60);
            const s = this.seconds%60;
            document.getElementById('game-timer').textContent = `‚è≥ ${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        }, 1000);
    },

    checkWin() {
        const closed = this.grid.flat().filter(c => !c.revealed).length;
        if(closed === this.mines) this.gameOver(true);
    },

    gameOver(win) {
        this.isActive = false;
        clearInterval(this.timer);
        
        this.grid.flat().forEach(c => {
            if(c.mine) {
                c.el.classList.add('mine');
                c.el.innerHTML = '<i class="fas fa-bomb"></i>';
            }
        });

        if(win) {
            AudioFX.win();
            App.showModal(I18N[App.lang].win, `Time: ${this.seconds}s`);
        } else {
            AudioFX.boom();
            App.showModal(I18N[App.lang].lose, "Try again!");
        }
    },

    /**
     * –õ–û–ì–ò–ö–ê –•–ò–ù–¢–û–í –ò SHORTS (–ó–ê–©–ò–¢–ê –û–¢ –°–ö–ò–ü–ê)
     */
    getHint() {
        if(!this.isActive) return;

        if(this.hintReady) {
            this.executeHint();
            this.hintReady = false;
        } else {
            this.openShortsModule();
        }
    },

    executeHint() {
        const safeCells = this.grid.flat().filter(c => !c.mine && !c.revealed);
        if(safeCells.length) {
            const pick = safeCells[Math.floor(Math.random()*safeCells.length)];
            pick.el.style.boxShadow = "inset 0 0 20px #fff, 0 0 25px var(--primary)";
            setTimeout(() => pick.el.style.boxShadow = "", 2000);
        }
    },

    openShortsModule() {
        const videoId = this.currentShorts[Math.floor(Math.random()*this.currentShorts.length)];
        const container = document.getElementById('shorts-container');
        const player = document.getElementById('yt-player');
        
        player.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&controls=0&disablekb=1`;
        container.classList.add('visible');

        let timeLeft = 15;
        const btn = document.getElementById('shorts-timer');
        btn.textContent = timeLeft + "s";

        const timer = setInterval(() => {
            timeLeft--;
            btn.textContent = timeLeft + "s";
            if(timeLeft <= 0) {
                clearInterval(timer);
                btn.textContent = "DONE";
                btn.style.background = "#00ff88";
                this.hintUnlocked = true;
            }
        }, 1000);

        this.shortsInterval = timer;
    },

    cancelShorts() {
        clearInterval(this.shortsInterval);
        document.getElementById('shorts-container').classList.remove('visible');
        document.getElementById('yt-player').src = "";
        
        if(this.hintUnlocked) {
            this.executeHint();
            this.hintUnlocked = false;
        }
    }
};

/**
 * ========================================================================
 * 5. –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï–ú (UI & STATE)
 * ========================================================================
 */
const App = {
    lang: 'ru',
    difficulty: 'easy',
    theme: 'neon',

    init() {
        this.updateStrings();
        Particles.init();
    },

    startGame() {
        this.showScreen('game');
        Game.init();
    },

    showScreen(id) {
        AudioFX.click();
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id + '-screen').classList.add('active');
    },

    updateStrings() {
        document.querySelectorAll('[data-i18n]').forEach(el => {
            el.textContent = I18N[this.lang][el.dataset.i18n];
        });
    },

    openSettings() {
        this.showModal(I18N[this.lang].settings, `
            <div style="text-align: left;">
                <label style="display:block; margin: 10px 0; opacity: 0.6; font-size: 0.8rem;">LANGUAGE</label>
                <select onchange="App.setLang(this.value)" style="width:100%; background:#1a1a2e; color:#fff; border:1px solid var(--primary); padding:12px; border-radius:10px;">
                    <option value="ru" ${this.lang==='ru'?'selected':''}>–†–£–°–°–ö–ò–ô</option>
                    <option value="en" ${this.lang==='en'?'selected':''}>ENGLISH</option>
                </select>

                <label style="display:block; margin: 15px 0 10px; opacity: 0.6; font-size: 0.8rem;">THEME</label>
                <select onchange="App.setTheme(this.value)" style="width:100%; background:#1a1a2e; color:#fff; border:1px solid var(--primary); padding:12px; border-radius:10px;">
                    <option value="neon">CYBER NEON</option>
                    <option value="ocean">DEEP OCEAN</option>
                    <option value="emerald">EMERALD FOREST</option>
                    <option value="gold">LUXURY GOLD</option>
                    <option value="blood">BLOOD MOON</option>
                </select>

                <label style="display:block; margin: 15px 0 10px; opacity: 0.6; font-size: 0.8rem;">DIFFICULTY</label>
                <select onchange="App.difficulty=this.value" style="width:100%; background:#1a1a2e; color:#fff; border:1px solid var(--primary); padding:12px; border-radius:10px;">
                    <option value="easy">${I18N[this.lang].easy}</option>
                    <option value="medium">${I18N[this.lang].med}</option>
                    <option value="expert">${I18N[this.lang].hard}</option>
                </select>
            </div>
        `);
    },

    setLang(l) { this.lang = l; this.updateStrings(); this.closeModal(); this.openSettings(); },
    setTheme(t) { document.body.setAttribute('data-theme', t); },

    openRecords() {
        this.showModal(I18N[this.lang].records, "<p style='opacity:0.5'>Leaders will appear here...</p>");
    },

    showModal(title, content) {
        document.getElementById('modal-title').textContent = title;
        document.getElementById('modal-desc').innerHTML = content;
        document.getElementById('modal-overlay').classList.add('visible');
    },

    closeModal() {
        document.getElementById('modal-overlay').classList.remove('visible');
    }
};

window.onload = () => App.init();
</script>
</body>
</html>
